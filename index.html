<!--
future updates:
- add horizontal scrolling to projects instead of vertical scrolling 
- make filters more intuitive "clear filters" button (?)
- remove appear on scroll, have them always exist
- make dark mode default
- change sun icon to bull (for USF colors)
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Fabrizio Petrozzi</title>
  <!-- Icon Classes -->
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />
  <!-- Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&display=swap" rel="stylesheet">
  <!-- External CSS -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Header and Navigation -->
  <header class="common-header">
    <div class="header-left">
      <button class="logo" onclick="window.location.reload();">FP</button>
    </div>
    <div class="header-center">
      <nav class="main-nav">
        <a href="#about"><span>About</span></a>
        <a href="#featured"><span>Featured</span></a>
        <a href="#projects"><span>Projects</span></a>
        <a href="#" id="contactLink"><span>Contact</span></a>
      </nav>
    </div>
    <div class="header-right">
         <!-- Dark Mode Toggle (positioned top left of the map) -->
      <div class="dark-mode-toggle">
        <input type="checkbox" id="darkModeToggle" class="dark-mode-toggle-input">
        <label for="darkModeToggle" class="dark-mode-toggle-label">
          <span class="toggle-slider">
            <span class="icon sun-icon">
              <ion-icon name="sunny"></ion-icon>
            </span>
            <span class="icon moon-icon">
              <ion-icon name="moon"></ion-icon>
            </span>
          </span>
        </label>
      </div>
    </div>
  </header>

  <!-- Main -->
<main class="main-content">
  <!-- Main Content -->
  <div class="container">
    <!-- About Section -->
    <section id="about">
      <div class="map-wrapper">
        <!-- Map -->
        <div id="map" class="map-container">
          <div class="map-overlay"></div>
        </div>

        <!-- Social Links (positioned as a column on the right side of the map) -->
        <div class="map-social-links">
          <div class="social-links">
            <a href="https://www.linkedin.com/in/fabriziopetrozzi/" target="_blank" aria-label="LinkedIn">
              <i class="bx bxl-linkedin"></i>
            </a>
            <a href="files/Resume.pdf" target="_blank" aria-label="Resume">
              <i class="bx bx-file"></i>
            </a>
            <a href="https://usfbusiness.com/2023/03/29/fabrizio-petrozzi-yanez-business-management/" target="_blank" aria-label="25 Under 25 Award">
              <i class="bx bx-trophy"></i>
            </a>
          </div>
        </div>

        <!-- Profile Card (overlapping bottom left of the map) -->
        <div class="profile-card">
          <img src="images/headshot2.jpg" alt="My Photo" class="profile-card-pic">
          <div class="profile-card-text">
            <p>Hey, I'm <span class="highlight-name">Fabrizio Petrozzi</span></p>
            <div class="profile-card-location">
              <i class="bx bx-map"></i>
              <span>St. Petersburg, FL</span>
            </div>
          </div>
        </div>
      </div>

      <!-- "Learn More..." text turned into a clickable link -->
      <div class="learn-more">
        <p>
          Master of Science candidate in Artificial Intelligence and Business Analytics at USF.
          <a href="#" class="learn-more-trigger highlight-name">Learn More...</a>
        </p>
      </div>

      <!-- Scroll nudge arrow (initially hidden) -->
      <div class="scroll-nudge">
        <i class="bx bx-chevron-down"></i>
      </div>
    </section>
    
          <!--experiences-->
        <section id="experienceSection">
          <!-- Experience Tabs -->
          <div class="experience-tabs">
            <button class="exp-tab active" data-target="workTimeline">Experience</button>
            <button class="exp-tab" data-target="educationTimeline">Education</button>
          </div>
          
          <!-- Work Timeline (remains on left) -->
          <div id="workTimeline" class="experience-timeline active">
            <div class="timeline-items-wrapper">
            <div class="experience-item">
              <div class="experience-circle">
                <img src="images/USF-logo.jpg" alt="Company Logo" />
              </div>
              <div class="experience-details">
                <div class="experience-date">Aug 2024 - May 2025</div>
                <div class="experience-name">USF MUMA College of Business</div>
                <div class="experience-role">Graduate Teaching Assistant, CGS 2100</div>
              </div>
            </div>
            <!-- Add more .experience-item blocks as needed -->
            <div class="experience-item">
              <div class="experience-circle">
                <img src="images/RJ-Logo.png" alt="Company Logo" />
              </div>
              <div class="experience-details">
                <div class="experience-date">Nov 2023 - Aug 2024</div>
                <div class="experience-name">Raymond James Bank</div>
                <div class="experience-role">Managed Customer Accounts Associate</div>
              </div>
            </div>
          </div>
        </div>
          <!-- Education Timeline (mirrored layout) -->
          <div id="educationTimeline" class="experience-timeline">
            <div class="timeline-items-wrapper">
            <div class="experience-item">
              <div class="experience-circle">
                <img src="images/USF-logo.jpg" alt="USF Logo" />
              </div>
              <div class="experience-details">
                <div class="experience-date">Aug 2024 - May 2026</div>
                <div class="experience-name">University of South Florida</div>
                <div class="experience-role">M.S. in Artificial Intelligence & Business Analytics</div>
                <div class="experience-GPA">Cumulative GPA: 4.0/4.0</div>
              </div>
            </div>
            <!-- Add more .experience-item blocks as needed -->
            <div class="experience-item">
              <div class="experience-circle">
                <img src="images/USF-logo.jpg" alt="USF Logo" />
              </div>
              <div class="experience-details">
                <div class="experience-date">Aug 2019 - Aug 2023</div>
                <div class="experience-name">University of South Florida</div>
                <div class="experience-role">B.S. in Business Management</div>
                <div class="experience-GPA">Cumulative GPA: 3.98/4.0</div>
              </div>
            </div>
            </div>  
          </div>
        </section>

      <!--Technologies Filter -->
      <section id="technologies">
      <h2>Technical Skills</h2>
      <div class="tech-filter-container">
        <!-- Python -->
        <button class="tech-filter-btn" data-tech="python">
          <i class="bx bxl-python"></i>
          <span>Python</span>
        </button>
        
        <!-- R -->
        <button class="tech-filter-btn" data-tech="r">
          <i class="bx bx-code-alt"></i>
          <span>R</span>
        </button>
        
        <!-- SQL -->
        <button class="tech-filter-btn" data-tech="sql">
          <i class="bx bx-data"></i>
          <span>SQL</span>
        </button>
        
        <!-- Node.js -->
        <button class="tech-filter-btn" data-tech="Node.js">
          <i class="bx bxl-nodejs"></i>
          <span>Node.js</span>
        </button> 
        
        <!-- HTML -->
        <button class="tech-filter-btn" data-tech="html">
          <i class="bx bxl-html5"></i>
          <span>HTML</span>
        </button>
        
        <!-- CSS -->
        <button class="tech-filter-btn" data-tech="css">
          <i class="bx bxl-css3"></i>
          <span>CSS</span>
        </button>
        
        <!-- JavaScript -->
        <button class="tech-filter-btn" data-tech="javascript">
          <i class="bx bxl-javascript"></i>
          <span>JavaScript</span>
        </button>

        <!-- MongoDB -->
        <button class="tech-filter-btn" data-tech="mongodb">
          <i class="bx bx-leaf"></i>
          <span>MongoDB</span>
        </button>

        <!-- Excel -->
        <button class="tech-filter-btn" data-tech="excel">
          <i class="bx bx-spreadsheet"></i>
          <span>Excel</span>
        </button>
        
        <!-- Machine Learning -->
        <button class="tech-filter-btn" data-tech="machine learning">
          <i class="bx bx-brain"></i>
          <span>Machine Learning</span>
        </button>
        
        <!-- Deep Learning -->
        <button class="tech-filter-btn" data-tech="deep learning">
          <i class="bx bx-chip"></i>
          <span>Deep Learning</span>
        </button>
        
        <!-- Text Analytics -->
        <button class="tech-filter-btn" data-tech="text analytics">
          <i class="bx bx-message-dots"></i>
          <span>Text Analytics</span>
        </button>
        
        <!-- Data Visualization -->
        <button class="tech-filter-btn" data-tech="data visualization">
          <i class="bx bx-line-chart"></i>
          <span>Data Visualization</span>
        </button>
        
        <!-- Cloud Computing -->
        <button class="tech-filter-btn" data-tech="cloud computing">
          <i class="bx bx-cloud"></i>
          <span>Cloud Computing</span>
        </button>

        <!-- Systems Architecture -->
        <button class="tech-filter-btn" data-tech="systems architecture">
          <i class="bx bx-sitemap"></i>
          <span>Systems Architecture</span>
        </button>
        
        <!-- UX / UI -->
        <button class="tech-filter-btn" data-tech="ux / ui">
          <i class="bx bx-layout"></i>
          <span>UX / UI</span>
        </button>

        <!-- Clear Filters -->
        <button class="tech-filter-btn" id="clearFilters">
          <i class="bx bx-x"></i>
            </button>
          </div>
        </section>
    
            <!-- Featured Section -->
          <div class="fadein-wrapper">
            <!-- Featured Projects Section -->
            <section id="featured">
              <h2>Featured Projects</h2>

              <div class="projects-carousel">
                <button class="carousel-btn prev" type="button" aria-label="Previous projects">‹</button>
              
                <div class="projects-grid">
                  <!-- Featured Project Card: Portfolio Website -->
                  <div class="project-item">
                    <div class="project-image-container">
                      <img src="images/HTML.jpg" alt="Portfolio Website">
                    </div>
                    <h3 class="project-title">Portfolio</h3>
                    <p class="project-description">
                      A website built to showcase projects.
                    </p>
                    <div class="project-tech">
                      <span class="tech-pill">HTML</span>
                      <span class="tech-pill">CSS</span>
                      <span class="tech-pill">JavaScript</span>
                      <span class="tech-pill">UX / UI</span>
                    </div>
                    <a href="https://github.com/f-petrozzi/f-petrozzi.github.io" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                  </div>
                  
                  <!-- Featured Project Card: Todoo iOS App -->
                  <div class="project-item">
                    <div class="project-image-container">
                      <img src="images/TodooProject.jpg" alt="Todoo App">
                    </div>
                    <h3 class="project-title">Todoo App</h3>
                    <p class="project-description">
                      Notes and tasks app with alarms and Siri shortcuts.
                    </p>
                    <div class="project-tech">
                      <span class="tech-pill">SQL</span>
                      <span class="tech-pill">Machine Learning</span>
                      <span class="tech-pill">Systems Architecture</span>
                      <span class="tech-pill">UX / UI</span>
                    </div>
                    <a href="https://github.com/f-petrozzi/Todoo_App" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                  </div>
                  
                  <!-- Featured Project Card: Optuna CNN Tuning -->
                  <div class="project-item">
                    <div class="project-image-container">
                      <img src="images/Optuna.png" alt="Optuna CNN Tuning">
                    </div>
                    <h3 class="project-title">Optuna</h3>
                    <p class="project-description">
                      Hyperparameter optimization framework for a small image classifier.
                    </p>
                    <div class="project-tech">
                      <span class="tech-pill">Python</span>
                      <span class="tech-pill">Machine Learning</span>
                    </div>
                    <a href="https://github.com/f-petrozzi/Optuna_CNN" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                  </div>
                </div>

                <button class="carousel-btn next" type="button" aria-label="Next projects">›</button>
              </div>
              
            </section>
          
          <!-- Other Projects Section -->
          <section id="projects">
            <h2>Other Projects</h2>
            <div class="projects-carousel">
              <button class="carousel-btn prev" type="button" aria-label="Previous projects">‹</button>

              <div class="projects-grid">
  
                <!-- Other Project Card: Chest X-ray Classification -->
                <div class="project-item">
                  <div class="project-image-container">
                    <img src="images/ImageClassifier.jpg" alt="Chest X-ray Disease Classifier">
                  </div>
                  <h3 class="project-title">Image Classifier</h3>
                  <p class="project-description">
                    Detects multiple conditions in chest X‑rays.
                  </p>
                  <div class="project-tech">
                    <span class="tech-pill">Python</span>
                    <span class="tech-pill">Deep Learning</span>
                  </div>
                  <a href="https://github.com/f-petrozzi/Image_Classification_DL" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                </div>
                <!-- Other Project Card: Healthcare Data Warehouse -->
                <div class="project-item">
                  <div class="project-image-container">
                    <img src="images/HealthcareDB.jpg" alt="Hospital Data Warehouse Insights">
                  </div>
                  <h3 class="project-title">Hospital Data Warehouse</h3>
                  <p class="project-description">
                    SQL analyses with visuals.
                  </p>
                  <div class="project-tech">
                    <span class="tech-pill">SQL</span>
                    <span class="tech-pill">Data Visualization</span>
                  </div>
                  <a href="https://github.com/f-petrozzi/Healthcare_Data_Warehouse" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                </div>
                <!-- Other Project Card: Applied Business Statistics -->
                <div class="project-item">
                  <div class="project-image-container">
                    <img src="images/businessstats.png" alt="Applied Business Statistics">
                  </div>
                  <h3 class="project-title">Business Statistics</h3>
                  <p class="project-description">
                    Regression models and optimization with Solver.
                  </p>
                  <div class="project-tech">
                    <span class="tech-pill">R</span>
                    <span class="tech-pill">Excel</span>
                  </div>
                  <a href="https://github.com/f-petrozzi/Business_Statistics" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                </div>
  
                <!-- Other Project Card: Regex Text Analytics -->
                <div class="project-item">
                  <div class="project-image-container">
                    <img src="images/regex.jpg" alt="Book Text Cleaner & Analyzer">
                  </div>
                  <h3 class="project-title">Text Cleaning & Analyzing</h3>
                  <p class="project-description">
                    Cleans public‑domain book, extracting patterns for analysis using Regex.
                  </p>
                  <div class="project-tech">
                    <span class="tech-pill">Python</span>
                    <span class="tech-pill">Text Analytics</span>
                  </div>
                  <a href="https://github.com/f-petrozzi/Regex_Text_Analytics" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                </div>
                
                <!-- Other Project Card: Amazon Redshift Reviews DB -->
                <div class="project-item">
                  <div class="project-image-container">
                    <img src="images/Redshift.jpg" alt="Amazon Redshift Transactional Database">
                  </div>
                  <h3 class="project-title">Product Reviews Analysis</h3>
                  <p class="project-description">
                    Combines Amazon product listings and reviews into a Redshift database for analysis.
                  </p>
                  <div class="project-tech">
                    <span class="tech-pill">Cloud Computing</span>
                    <span class="tech-pill">SQL</span>
                    <span class="tech-pill">Python</span>
                  </div>
                  <a href="https://github.com/f-petrozzi/Amazon_Redshift_Transactional_DB" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                </div>
                
                <!-- Other Project Card: Titanic Survival Prediction -->
                <div class="project-item">
                  <div class="project-image-container">
                    <img src="images/titanic.jpg" alt="Titanic Survival Prediction">
                  </div>
                  <h3 class="project-title">Titanic Survival Predictor</h3>
                  <p class="project-description">
                    Trains models to predict who survived the Titanic.
                  </p>
                  <div class="project-tech">
                    <span class="tech-pill">Python</span>
                    <span class="tech-pill">Machine Learning</span>
                  </div>
                  <a href="https://github.com/f-petrozzi/Titanic_Survival_Prediction_ML" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                </div>
              
                <!-- Other Project Card: Tixly Mobile Ticketing Design -->
                <div class="project-item">
                  <div class="project-image-container">
                    <img src="images/Tixly.jpg" alt="Tixly Mobile Ticketing App Design">
                  </div>
                  <h3 class="project-title">Tixly App Design</h3>
                  <p class="project-description">
                    Architecture for a mobile ticketing app, including flows, UML, microservices, and low to high-fidelity designs.
                  </p>
                  <div class="project-tech">
                    <span class="tech-pill">Systems Architecture</span>
                    <span class="tech-pill">UX / UI</span>
                  </div>
                  <a href="https://github.com/f-petrozzi/Tixly_App_Design" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                </div>
                
                <!-- Other Project Card: MongoDB Hospital Scheduling & Billing -->
                <div class="project-item">
                  <div class="project-image-container">
                    <img src="images/mongodb.jpg" alt="Hospital Scheduling and Billing">
                  </div>
                  <h3 class="project-title">MongoDB</h3>
                  <p class="project-description">
                    A database that tracks appointments, doctors, patients, and billing, with sample data and queries.
                  </p>
                  <div class="project-tech">
                    <span class="tech-pill">MongoDB</span>
                    <span class="tech-pill">JavaScript</span>
                    <span class="tech-pill">Python</span>
                  </div>
                  <a href="https://github.com/f-petrozzi/MongoDB" target="_blank" rel="noopener noreferrer" class="project-link">View on GitHub</a>
                </div>
              
              </div>
              <button class="carousel-btn next" type="button" aria-label="Next projects">›</button>
            </div>
          </section>
      </div>
    </div>
  </main> 
  
  
  <!-- Footer -->
  <footer>
    <p>&copy; <span id="year"></span> Fabrizio Petrozzi. All rights reserved.</p>
  </footer>
  
  <!-- Contact Modal -->
  <div id="contactModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Contact Me</h2>
      <p>
        Feel free to reach out to me via email at 
        <a href="mailto:petrozzi@usf.edu">petrozzi@usf.edu</a>.
      </p>
    </div>
  </div>
  
  <!-- Scripts -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <script src="darkmode.js"></script>
  <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
  
 <!-- Main Page Scripts -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  /* ==========================================================
     1. Header Scroll Behavior
  ========================================================== */
  let lastScrollTop = 0;
  const header = document.querySelector('header.common-header');
  const scrollThreshold = 10; // Minimum scroll amount to trigger header visibility change
  
  if (header) {
    window.addEventListener('scroll', function() {
      let currentScroll = window.pageYOffset || document.documentElement.scrollTop;
      if (Math.abs(lastScrollTop - currentScroll) <= scrollThreshold) return;
      if (currentScroll > lastScrollTop && currentScroll > header.offsetHeight) {
        header.classList.add('header-hidden');
      } else {
        header.classList.remove('header-hidden');
      }
      lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
    }, { passive: true });
  } else {
    console.error("Header element not found!");
  }

  /* ==========================================================
     2. Auto-update Footer Year
  ========================================================== */
  const yearElem = document.getElementById("year");
  if (yearElem) {
    yearElem.textContent = new Date().getFullYear();
  }
  
  /* ==========================================================
     3. Contact Modal Functionality
  ========================================================== */
  const modal = document.getElementById("contactModal");
  const contactLink = document.getElementById("contactLink");
  const closeBtn = document.getElementsByClassName("close")[0];
  
  if (contactLink && modal && closeBtn) {
    contactLink.addEventListener("click", function(e) {
      e.preventDefault();
      modal.style.display = "block";
    });
    closeBtn.addEventListener("click", function() {
      modal.style.display = "none";
    });
    window.addEventListener("click", function(e) {
      if (e.target === modal) {
        modal.style.display = "none";
      }
    });
  }
  
  /* ==========================================================
     4. Smooth Scrolling for Anchor Links
  ========================================================== */
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener("click", function(e) {
      if (this.getAttribute("href") === "#") return;
      e.preventDefault();
      const target = document.querySelector(this.getAttribute("href"));
      if (target) {
        target.scrollIntoView({ behavior: "smooth" });
      }
    });
  });

  /* ==========================================================
     5. Learn More Click Activation (Social Sequence & Scroll Nudge)
  ========================================================== */
  const learnMoreLink = document.querySelector(".learn-more-trigger");
  let isAnimating = false;
  if (learnMoreLink) {
    learnMoreLink.addEventListener("click", function(e) {
      e.preventDefault();
      if (isAnimating) return;
      isAnimating = true;
      console.log("Learn More link was clicked!");
      document.body.classList.remove("social-sequence-active", "show-scroll-nudge");
      document.body.classList.add("social-sequence-active");
      setTimeout(() => {
        document.body.classList.add("show-scroll-nudge");
        console.log("Scroll nudge revealed!");
      }, 1800);
      setTimeout(() => {
        document.body.classList.remove("social-sequence-active", "show-scroll-nudge");
        isAnimating = false;
        console.log("Cycle complete, ready to trigger again.");
      }, 5600);
    });
  } else {
    console.error("Learn More trigger not found!");
  }
});
/* ==========================================================
     6. Experience Toggle
  ========================================================== */
  const tabButtons = document.querySelectorAll(".exp-tab");
  const timelines = document.querySelectorAll(".experience-timeline");

  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      // Remove active class from all tabs
      tabButtons.forEach(b => b.classList.remove("active"));
      // Add active class to the clicked tab
      btn.classList.add("active");
      
      // Hide all timelines
      timelines.forEach(tl => tl.classList.remove("active"));
      
      // Show the timeline corresponding to the clicked tab
      const targetId = btn.getAttribute("data-target");
      document.getElementById(targetId).classList.add("active");
    });
  });

  /* Height Equalizer */
function getNaturalHeight(el) {
  // Clone the element and make it temporarily visible off-screen
  const clone = el.cloneNode(true);
  clone.style.visibility = 'hidden';
  clone.style.display = 'block';
  clone.style.position = 'absolute';
  clone.style.height = 'auto';
  clone.style.minHeight = '';
  document.body.appendChild(clone);
  const height = clone.offsetHeight;
  document.body.removeChild(clone);
  return height;
}

function equalizeTimelineHeights() {
  const workTimeline = document.getElementById('workTimeline');
  const educationTimeline = document.getElementById('educationTimeline');
  
  // Remove any inline min-height to get natural heights
  workTimeline.style.minHeight = "";
  educationTimeline.style.minHeight = "";
  
  // Get the natural heights of both timelines
  const workHeight = getNaturalHeight(workTimeline);
  const eduHeight = getNaturalHeight(educationTimeline);
  
  // Use the maximum of the two heights
  const maxHeight = Math.max(workHeight, eduHeight);
  
  workTimeline.style.minHeight = maxHeight + "px";
  educationTimeline.style.minHeight = maxHeight + "px";
}

// Run on window resize, on tab toggle, and on initial load
window.addEventListener('resize', equalizeTimelineHeights);
document.querySelectorAll('.exp-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    // Allow a slight delay to let the content update before equalizing heights
    setTimeout(equalizeTimelineHeights, 100);
  });
});
equalizeTimelineHeights();
/* ==========================================================
   7. Technology Filters
=========================================================== */

// Select the tech filter buttons (excluding the clear button)
const techButtons = document.querySelectorAll('.tech-filter-btn:not(#clearFilters)');
let selectedTechs = [];

// Toggle active state on tech buttons
techButtons.forEach(btn => {
  btn.addEventListener('click', function() {
    btn.classList.toggle('active');
    updateSelectedTechs();
    filterProjects();
  });
});

// Clear Filters button
document.getElementById('clearFilters').addEventListener('click', function() {
  techButtons.forEach(btn => btn.classList.remove('active'));
  selectedTechs = [];
  filterProjects();
});

// Update the list of selected technologies from the active filter buttons
function updateSelectedTechs() {
  selectedTechs = Array.from(techButtons)
    .filter(btn => btn.classList.contains('active'))
    .map(btn => btn.getAttribute('data-tech').toLowerCase());
}

// Filter projects based on the technology names extracted from the project's tech-pill elements
function filterProjects() {
  const allProjects = document.querySelectorAll('.project-item');
  allProjects.forEach(project => {
    // Grab all tech-pill elements inside the project's tech container
    const techElements = project.querySelectorAll('.project-tech .tech-pill');
    // Create an array of technology names (lowercase) for this project
    const projectTechs = Array.from(techElements)
      .map(el => el.textContent.trim().toLowerCase());
    
    // If no filters are active, show all projects
    if (selectedTechs.length === 0) {
      project.style.display = '';
    } else {
      // Show project if any active filter matches a tech in the project
      const shouldShow = selectedTechs.some(filter => projectTechs.includes(filter));
      project.style.display = shouldShow ? '' : 'none';
    }
  });
}

  /* ==========================================================
     7.5 Project Scroll Behavior
  ========================================================== */
  (() => {
  function initCarousel(wrapper) {
    const grid = wrapper.querySelector('.projects-grid');
    const prevBtn = wrapper.querySelector('.carousel-btn.prev');
    const nextBtn = wrapper.querySelector('.carousel-btn.next');
    let start = 0;

    function eligibleItems() {
      const items = Array.from(grid.querySelectorAll('.project-item'));
      return items.filter(el => getComputedStyle(el).display !== 'none');
    }

    function countTracks(trackList) {
      if (!trackList || trackList === 'none') return null;
      let depth = 0, token = '', count = 0;
      for (const ch of trackList) {
        if (ch === '(') depth++;
        if (ch === ')') depth--;
        if (ch === ' ' && depth === 0) {
          if (token.trim()) { count++; token = ''; }
        } else {
          token += ch;
        }
      }
      if (token.trim()) count++;
      return count || null;
    }

    function perViewFromGrid() {
      const columns = getComputedStyle(grid).gridTemplateColumns;
      let pv = countTracks(columns);
      if (!pv) {
        const vis = eligibleItems();
        if (vis.length <= 1) return 1;
        const top = vis[0].offsetTop;
        let c = 0;
        for (const el of vis) { if (el.offsetTop === top) c++; else break; }
        pv = c || 1;
      }
      return pv;
    }

    function render() {
      const all = Array.from(grid.querySelectorAll('.project-item'));
      const vis = eligibleItems();
      const total = vis.length;
      const perView = perViewFromGrid();

      // center if fewer than the window size
      if (total <= perView) grid.classList.add('carousel-center');
      else grid.classList.remove('carousel-center');

      // clamp start and compute max page start
      const maxStart = Math.max(0, total - perView);
      start = Math.min(Math.max(0, start), maxStart);

      // hide all, then unhide only the current window
      all.forEach(el => el.classList.add('is-hidden'));
      for (let i = 0; i < perView && i + start < total; i++) {
        vis[i + start].classList.remove('is-hidden');
      }

      // button visibility
      if (total <= perView) {
        prevBtn.classList.add('is-hidden');
        nextBtn.classList.add('is-hidden');
      } else {
        prevBtn.classList.toggle('is-hidden', start === 0);
        nextBtn.classList.toggle('is-hidden', start === maxStart);
      }
    }

    function step(dir) { start += dir; render(); }

    prevBtn.addEventListener('click', () => step(-1));
    nextBtn.addEventListener('click', () => step(1));

    // recompute on resize without resetting the window unless needed
    let raf;
    window.addEventListener('resize', () => {
      cancelAnimationFrame(raf);
      raf = requestAnimationFrame(render);
    });

    // react to filter changes
    window.addEventListener('projects:filterchanged', () => { start = 0; render(); });

    // fallback: observe display/class changes inside the grid
    const mo = new MutationObserver(muts => {
      if (muts.some(m => m.type === 'attributes')) { start = 0; render(); }
    });
    mo.observe(grid, { attributes: true, subtree: true, attributeFilter: ['style', 'class'] });

    render();
    return { render, reset: () => { start = 0; render(); } };
  }

  // patch existing filterProjects() to notify carousels
  function patchFilter() {
    const original = window.filterProjects;
    if (typeof original === 'function') {
      window.filterProjects = function(...args) {
        const out = original.apply(this, args);
        window.dispatchEvent(new CustomEvent('projects:filterchanged'));
        return out;
      };
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    patchFilter();
    const wrappers = document.querySelectorAll('.projects-carousel');
    const instances = Array.from(wrappers).map(initCarousel);
    // optional hook your code can call after changing filters
    window.refreshCarousels = () => {
      window.dispatchEvent(new CustomEvent('projects:filterchanged'));
      instances.forEach(i => i.render());
    };
  });
})();
</script>
<script type="module">
  /* ==========================================================
     8. Map
  ========================================================== */
// Define the two map style URLs (make sure they match the correct theme)
  const lightStyle = 'https://tiles.basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json';
  const darkStyle = 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json';

  // Check the saved theme; default to 'light' if not set
  const savedTheme = localStorage.getItem('theme') || 'light';
  // Use the appropriate map style based on the saved theme
  const defaultStyle = savedTheme === 'dark' ? darkStyle : lightStyle;

  // Initialize the map with the default style
  const map = new maplibregl.Map({
    container: 'map',
    style: defaultStyle,
    center: [-82.6384, 27.7671],
    zoom: 8,
    attributionControl: false
  });

  // Add your custom marker to the map
  const markerEl = document.createElement('div');
  markerEl.className = 'custom-marker';
  new maplibregl.Marker({ element: markerEl })
    .setLngLat([-82.6384, 27.7671])
    .addTo(map);

  // When the DOM is ready, attach an event listener to the dark mode toggle
  document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('darkModeToggle');
    if (toggle) {
      // Set the toggle's checked state based on the saved theme
      toggle.checked = savedTheme === 'dark';
      toggle.addEventListener('change', function() {
        // When checked, use darkStyle; when unchecked, use lightStyle
        map.setStyle(this.checked ? darkStyle : lightStyle);
      });
    }
  });
</script>
</body>
</html>
